!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,r,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(t,n,a,o){var s=n&&n.prototype instanceof u?n:u,c=Object.create(s.prototype);return i(c,"_invoke",function(t,i,n){var a,o,s,u=0,c=n||[],h=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,i){return a=t,o=0,s=e,d.n=i,l}};function f(t,i){for(o=t,s=i,r=0;!h&&u&&!n&&r<c.length;r++){var n,a=c[r],f=d.p,p=a[2];t>3?(n=p===i)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=f&&((n=t<2&&f<a[1])?(o=0,d.v=i,d.n=a[1]):f<p&&(n=t<3||a[0]>i||i>p)&&(a[4]=t,a[5]=i,d.n=p,o=0))}if(n||t>1)return l;throw h=!0,i}return function(n,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,s=p;(r=o<2?e:s)||!h;){a||(o?o<3?(o>1&&(d.n=-1),f(o,s)):d.n=s:d.v=s);try{if(u=2,a){if(o||(n="next"),r=a[n]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,o<2&&(o=0)}else 1===o&&(r=a.return)&&r.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+n+"' method"),o=1);a=e}else if((r=(h=d.n<0)?s:t.call(i,d))!==l)break}catch(r){a=e,o=1,s=r}finally{u=1}}return{value:r,done:h}}}(t,a,o),!0),c}var l={};function u(){}function c(){}function h(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(i(r={},a,function(){return this}),r),f=h.prototype=u.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,i(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=h,i(f,"constructor",h),i(h,"constructor",c),c.displayName="GeneratorFunction",i(h,o,"GeneratorFunction"),i(f),i(f,o,"Generator"),i(f,a,function(){return this}),i(f,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:p}})()}function i(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}i=function(e,t,r,n){if(t)a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var o=function(t,r){i(e,t,function(e){return this._invoke(t,r,e)})};o("next",0),o("throw",1),o("return",2)}},i(e,t,r,n)}function r(e,t,i,r,n,a,o){try{var s=e[a](o),l=s.value}catch(e){return void i(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function a(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,i||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==e(i)?i:i+""}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(t,i,r){return i=c(i),function(t,i){if(i&&("object"==e(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,u()?Reflect.construct(i,r||[],c(t).constructor):i.apply(t,r))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(u=function(){return!!e})()}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function f(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return p(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}System.register(["./skinview-utils-legacy-Dq91f6g_.js","./three-legacy-BZxqGyoo.js"],function(e,i){"use strict";var n,o,u,c,d,p,b,v,m,y,g,w,x,P,k,O,j,T,M,L,R,C,E,S,_,A,B,z,D,W,I,F,U,Q,q,G,J;return{setters:[function(e){n=e.i,o=e.l,u=e.a,c=e.b,d=e.c,p=e.d,b=e.e},function(e){v=e.G,m=e.M,y=e.F,g=e.D,w=e.B,x=e.a,P=e.V,k=e.S,O=e.b,j=e.C,T=e.N,M=e.A,L=e.P,R=e.c,C=e.d,E=e.W,S=e.e,_=e.f,A=e.g,B=e.E,z=e.R,D=e.h,W=e.i,I=e.O,F=e.j,U=e.k,Q=e.T,q=e.l,G=e.m,J=e.n}],execute:function(){function i(e,t,i,r,n,a,o,s){for(var l=function(e,t,i,r){return[new P(e/o,1-r/s),new P(i/o,1-r/s),new P(i/o,1-t/s),new P(e/o,1-t/s)]},u=l(t+a,i,t+r+a,i+a),c=l(t+r+a,i,t+2*r+a,i+a),h=l(t,i+a,t+a,i+a+n),d=l(t+a,i+a,t+r+a,i+a+n),p=l(t+r+a,i+a,t+r+2*a,i+n+a),b=l(t+r+2*a,i+a,t+2*r+2*a,i+n+a),v=e.attributes.uv,m=[],y=0,g=[[p[3],p[2],p[0],p[1]],[h[3],h[2],h[0],h[1]],[u[3],u[2],u[0],u[1]],[c[0],c[1],c[3],c[2]],[d[3],d[2],d[0],d[1]],[b[3],b[2],b[0],b[1]]];y<g.length;y++){var w,x=f(g[y]);try{for(x.s();!(w=x.n()).done;){var k=w.value;m.push(k.x,k.y)}}catch(O){x.e(O)}finally{x.f()}}v.set(new Float32Array(m)),v.needsUpdate=!0}function V(e,t,r,n,a,o){i(e,t,r,n,a,o,64,64)}function N(e,t,r,n,a,o){i(e,t,r,n,a,o,64,32)}var Z=function(e){function t(e,i){var r;return s(this,t),r=l(this,t),Object.defineProperty(r,"innerLayer",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(r,"outerLayer",{enumerable:!0,configurable:!0,writable:!0,value:i}),e.name="inner",i.name="outer",r}return h(t,e),a(t)}(v),$=function(e){function t(){var e;s(this,t),e=l(this,t),Object.defineProperty(e,"head",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"rightArm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"leftArm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"rightLeg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"leftLeg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"modelListeners",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(e,"slim",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"_map",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(e,"layer1Material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"layer1MaterialBiased",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"layer2Material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"layer2MaterialBiased",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.layer1Material=new m({side:y}),e.layer2Material=new m({side:g,transparent:!0,alphaTest:1e-5}),e.layer1MaterialBiased=e.layer1Material.clone(),e.layer1MaterialBiased.polygonOffset=!0,e.layer1MaterialBiased.polygonOffsetFactor=1,e.layer1MaterialBiased.polygonOffsetUnits=1,e.layer2MaterialBiased=e.layer2Material.clone(),e.layer2MaterialBiased.polygonOffset=!0,e.layer2MaterialBiased.polygonOffsetFactor=1,e.layer2MaterialBiased.polygonOffsetUnits=1;var i=new w(8,8,8);V(i,0,0,8,8,8);var r=new x(i,e.layer1Material),n=new w(9,9,9);V(n,32,0,8,8,8);var a=new x(n,e.layer2Material);e.head=new Z(r,a),e.head.name="head",e.head.add(r,a),r.position.y=4,a.position.y=4,e.add(e.head);var o=new w(8,12,4);V(o,16,16,8,12,4);var u=new x(o,e.layer1Material),c=new w(8.5,12.5,4.5);V(c,16,32,8,12,4);var h=new x(c,e.layer2Material);e.body=new Z(u,h),e.body.name="body",e.body.add(u,h),e.body.position.y=-6,e.add(e.body);var d=new w,f=new x(d,e.layer1MaterialBiased);e.modelListeners.push(function(){f.scale.x=e.slim?3:4,f.scale.y=12,f.scale.z=4,V(d,40,16,e.slim?3:4,12,4)});var p=new w,b=new x(p,e.layer2MaterialBiased);e.modelListeners.push(function(){b.scale.x=e.slim?3.5:4.5,b.scale.y=12.5,b.scale.z=4.5,V(p,40,32,e.slim?3:4,12,4)});var P=new v;P.add(f,b),e.modelListeners.push(function(){P.position.x=e.slim?-.5:-1}),P.position.y=-4,e.rightArm=new Z(f,b),e.rightArm.name="rightArm",e.rightArm.add(P),e.rightArm.position.x=-5,e.rightArm.position.y=-2,e.add(e.rightArm);var k=new w,O=new x(k,e.layer1MaterialBiased);e.modelListeners.push(function(){O.scale.x=e.slim?3:4,O.scale.y=12,O.scale.z=4,V(k,32,48,e.slim?3:4,12,4)});var j=new w,T=new x(j,e.layer2MaterialBiased);e.modelListeners.push(function(){T.scale.x=e.slim?3.5:4.5,T.scale.y=12.5,T.scale.z=4.5,V(j,48,48,e.slim?3:4,12,4)});var M=new v;M.add(O,T),e.modelListeners.push(function(){M.position.x=e.slim?.5:1}),M.position.y=-4,e.leftArm=new Z(O,T),e.leftArm.name="leftArm",e.leftArm.add(M),e.leftArm.position.x=5,e.leftArm.position.y=-2,e.add(e.leftArm);var L=new w(4,12,4);V(L,0,16,4,12,4);var R=new x(L,e.layer1MaterialBiased),C=new w(4.5,12.5,4.5);V(C,0,32,4,12,4);var E=new x(C,e.layer2MaterialBiased),S=new v;S.add(R,E),S.position.y=-6,e.rightLeg=new Z(R,E),e.rightLeg.name="rightLeg",e.rightLeg.add(S),e.rightLeg.position.x=-1.9,e.rightLeg.position.y=-12,e.rightLeg.position.z=-.1,e.add(e.rightLeg);var _=new w(4,12,4);V(_,16,48,4,12,4);var A=new x(_,e.layer1MaterialBiased),B=new w(4.5,12.5,4.5);V(B,0,48,4,12,4);var z=new x(B,e.layer2MaterialBiased),D=new v;return D.add(A,z),D.position.y=-6,e.leftLeg=new Z(A,z),e.leftLeg.name="leftLeg",e.leftLeg.add(D),e.leftLeg.position.x=1.9,e.leftLeg.position.y=-12,e.leftLeg.position.z=-.1,e.add(e.leftLeg),e.modelType="default",e}return h(t,e),a(t,[{key:"map",get:function(){return this._map},set:function(e){this._map=e,this.layer1Material.map=e,this.layer1Material.needsUpdate=!0,this.layer1MaterialBiased.map=e,this.layer1MaterialBiased.needsUpdate=!0,this.layer2Material.map=e,this.layer2Material.needsUpdate=!0,this.layer2MaterialBiased.map=e,this.layer2MaterialBiased.needsUpdate=!0}},{key:"modelType",get:function(){return this.slim?"slim":"default"},set:function(e){this.slim="slim"===e,this.modelListeners.forEach(function(e){return e()})}},{key:"getBodyParts",value:function(){return this.children.filter(function(e){return e instanceof Z})}},{key:"setInnerLayerVisible",value:function(e){this.getBodyParts().forEach(function(t){return t.innerLayer.visible=e})}},{key:"setOuterLayerVisible",value:function(e){this.getBodyParts().forEach(function(t){return t.outerLayer.visible=e})}},{key:"resetJoints",value:function(){this.head.rotation.set(0,0,0),this.leftArm.rotation.set(0,0,0),this.rightArm.rotation.set(0,0,0),this.leftLeg.rotation.set(0,0,0),this.rightLeg.rotation.set(0,0,0),this.body.rotation.set(0,0,0),this.head.position.y=0,this.body.position.y=-6,this.body.position.z=0,this.rightArm.position.x=-5,this.rightArm.position.y=-2,this.rightArm.position.z=0,this.leftArm.position.x=5,this.leftArm.position.y=-2,this.leftArm.position.z=0,this.rightLeg.position.x=-1.9,this.rightLeg.position.y=-12,this.rightLeg.position.z=-.1,this.leftLeg.position.x=1.9,this.leftLeg.position.y=-12,this.leftLeg.position.z=-.1}}])}(v),H=function(e){function t(){var e;s(this,t),e=l(this,t),Object.defineProperty(e,"cape",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.material=new m({side:g,transparent:!0,alphaTest:1e-5});var i=new w(10,16,1);return N(i,0,0,10,16,1),e.cape=new x(i,e.material),e.cape.position.y=-8,e.cape.position.z=.5,e.add(e.cape),e}return h(t,e),a(t,[{key:"map",get:function(){return this.material.map},set:function(e){this.material.map=e,this.material.needsUpdate=!0}}])}(v),K=function(e){function t(){var e;s(this,t),e=l(this,t),Object.defineProperty(e,"leftWing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"rightWing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.material=new m({side:g,transparent:!0,alphaTest:1e-5});var i=new w(12,22,4);N(i,22,0,10,20,2);var r=new x(i,e.material);r.position.x=-5,r.position.y=-10,r.position.z=-1,e.leftWing=new v,e.leftWing.add(r),e.add(e.leftWing);var n=new w(12,22,4);N(n,22,0,10,20,2);var a=new x(n,e.material);return a.scale.x=-1,a.position.x=5,a.position.y=-10,a.position.z=-1,e.rightWing=new v,e.rightWing.add(a),e.add(e.rightWing),e.leftWing.position.x=5,e.leftWing.rotation.x=.2617994,e.resetJoints(),e}return h(t,e),a(t,[{key:"resetJoints",value:function(){this.leftWing.rotation.y=.01,this.leftWing.rotation.z=.2617994,this.updateRightWing()}},{key:"updateRightWing",value:function(){this.rightWing.position.x=-this.leftWing.position.x,this.rightWing.position.y=this.leftWing.position.y,this.rightWing.rotation.x=this.leftWing.rotation.x,this.rightWing.rotation.y=-this.leftWing.rotation.y,this.rightWing.rotation.z=-this.leftWing.rotation.z}},{key:"map",get:function(){return this.material.map},set:function(e){this.material.map=e,this.material.needsUpdate=!0}}])}(v),X=function(e){function t(){var e;s(this,t),e=l(this,t),Object.defineProperty(e,"rightEar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"leftEar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.material=new m({side:y});var r=new w(8,8,4/3);return i(r,0,0,6,6,1,14,7),e.rightEar=new x(r,e.material),e.rightEar.name="rightEar",e.rightEar.position.x=-6,e.add(e.rightEar),e.leftEar=new x(r,e.material),e.leftEar.name="leftEar",e.leftEar.position.x=6,e.add(e.leftEar),e}return h(t,e),a(t,[{key:"map",get:function(){return this.material.map},set:function(e){this.material.map=e,this.material.needsUpdate=!0}}])}(v),Y=10.8*Math.PI/180,ee=function(e){function t(){var e;return s(this,t),e=l(this,t),Object.defineProperty(e,"skin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"cape",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"elytra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"ears",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.skin=new $,e.skin.name="skin",e.skin.position.y=8,e.add(e.skin),e.cape=new H,e.cape.name="cape",e.cape.position.y=8,e.cape.position.z=-2,e.cape.rotation.x=Y,e.cape.rotation.y=Math.PI,e.add(e.cape),e.elytra=new K,e.elytra.name="elytra",e.elytra.position.y=8,e.elytra.position.z=-2,e.elytra.visible=!1,e.add(e.elytra),e.ears=new X,e.ears.name="ears",e.ears.position.y=10,e.ears.position.z=2/3,e.ears.visible=!1,e.skin.head.add(e.ears),e}return h(t,e),a(t,[{key:"backEquipment",get:function(){return this.cape.visible?"cape":this.elytra.visible?"elytra":null},set:function(e){this.cape.visible="cape"===e,this.elytra.visible="elytra"===e}},{key:"resetJoints",value:function(){this.skin.resetJoints(),this.cape.rotation.x=Y,this.cape.position.y=8,this.cape.position.z=-2,this.elytra.position.y=8,this.elytra.position.z=-2,this.elytra.rotation.x=0,this.elytra.resetJoints()}}])}(v),te=function(e){function t(){var e;return s(this,t),e=l(this,t,arguments),Object.defineProperty(e,"headBobbing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),e}return h(t,e),a(t,[{key:"animate",value:function(e){var t=8*this.progress;e.skin.leftLeg.rotation.x=.5*Math.sin(t),e.skin.rightLeg.rotation.x=.5*Math.sin(t+Math.PI),e.skin.leftArm.rotation.x=.5*Math.sin(t+Math.PI),e.skin.rightArm.rotation.x=.5*Math.sin(t);var i=.02*Math.PI;e.skin.leftArm.rotation.z=.03*Math.cos(t)+i,e.skin.rightArm.rotation.z=.03*Math.cos(t+Math.PI)-i,this.headBobbing?(e.skin.head.rotation.y=.2*Math.sin(t/4),e.skin.head.rotation.x=.1*Math.sin(t/5)):(e.skin.head.rotation.y=0,e.skin.head.rotation.x=0);var r=.06*Math.PI;e.cape.rotation.x=.06*Math.sin(t/1.5)+r}}])}(function(){return a(function e(){s(this,e),Object.defineProperty(this,"speed",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"paused",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"progress",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"currentId",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"progress0",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"animationObjects",{enumerable:!0,configurable:!0,writable:!0,value:new Map})},[{key:"update",value:function(e,t){var i=this;if(!this.paused){var r=t*this.speed;this.animate(e,r),this.animationObjects.forEach(function(t,r){var n=i.progress0.get(r);t(e,i.progress-n,r)}),this.progress+=r}}},{key:"addAnimation",value:function(e){var t=this.currentId++;return this.progress0.set(t,this.progress),this.animationObjects.set(t,e),t}},{key:"removeAnimation",value:function(e){void 0!==e&&(this.animationObjects.delete(e),this.progress0.delete(e))}}])}());e("W",te);var ie=function(e){function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,i);var n=new O({transparent:!0,alphaTest:1e-5});return e=l(this,i,[n]),Object.defineProperty(e,"painted",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"font",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"margin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"textStyle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"backgroundStyle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(e,"textMaterial",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.textMaterial=n,e.text=t,e.font=void 0===r.font?"48px Minecraft":r.font,e.margin=void 0===r.margin?[5,10,5,10]:r.margin,e.textStyle=void 0===r.textStyle?"white":r.textStyle,e.backgroundStyle=void 0===r.backgroundStyle?"rgba(0,0,0,.25)":r.backgroundStyle,e.height=void 0===r.height?4:r.height,(void 0===r.repaintAfterLoaded||r.repaintAfterLoaded)&&!document.fonts.check(e.font,e.text)?(e.paint(),e.painted=e.loadAndPaint()):(e.paint(),e.painted=Promise.resolve()),e}return h(i,e),a(i,[{key:"loadAndPaint",value:(n=t().m(function e(){return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,document.fonts.load(this.font,this.text);case 1:this.paint();case 2:return e.a(2)}},e,this)}),o=function(){var e=this,t=arguments;return new Promise(function(i,a){var o=n.apply(e,t);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)})},function(){return o.apply(this,arguments)})},{key:"paint",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");t.font=this.font;var i=t.measureText(this.text);e.width=this.margin[3]+i.actualBoundingBoxLeft+i.actualBoundingBoxRight+this.margin[1],e.height=this.margin[0]+i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+this.margin[2],(t=e.getContext("2d")).font=this.font,t.fillStyle=this.backgroundStyle,t.fillRect(0,0,e.width,e.height),t.fillStyle=this.textStyle,t.fillText(this.text,this.margin[3]+i.actualBoundingBoxLeft,this.margin[0]+i.actualBoundingBoxAscent);var r=new j(e);r.magFilter=T,r.minFilter=T,this.textMaterial.map=r,this.textMaterial.needsUpdate=!0,this.scale.x=e.width/e.height*this.height,this.scale.y=this.height}}]);var n,o}(k),re=function(){return a(function e(){var t,i,r,n,a,o=this,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e),Object.defineProperty(this,"canvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"renderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"controls",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerObject",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerWrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"globalLight",{enumerable:!0,configurable:!0,writable:!0,value:new M(16777215,3)}),Object.defineProperty(this,"cameraLight",{enumerable:!0,configurable:!0,writable:!0,value:new L(16777215,.6)}),Object.defineProperty(this,"composer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"renderPass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fxaaPass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"skinCanvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"capeCanvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"earsCanvas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"skinTexture",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"capeTexture",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"earsTexture",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"backgroundTexture",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_disposed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_renderPaused",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_zoom",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isUserRotating",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"autoRotate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"autoRotateSpeed",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_animation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"animationID",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onContextLost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onContextRestored",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pixelRatio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"devicePixelRatioQuery",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onDevicePixelRatioChange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nameTag",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.canvas=null!==(t=l.canvas)&&void 0!==t?t:document.createElement("canvas"),this.skinCanvas=document.createElement("canvas"),this.capeCanvas=document.createElement("canvas"),this.earsCanvas=document.createElement("canvas"),this.scene=new R,this.camera=new C,this.camera.add(this.cameraLight),this.scene.add(this.camera,this.globalLight),J.enabled=!1,this.renderer=new E({canvas:this.canvas,preserveDrawingBuffer:!0===l.preserveDrawingBuffer}),this.onDevicePixelRatioChange=function(){o.renderer.setPixelRatio(window.devicePixelRatio),o.updateComposerSize(),"match-device"===o._pixelRatio&&(o.devicePixelRatioQuery=matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")),o.devicePixelRatioQuery.addEventListener("change",o.onDevicePixelRatioChange,{once:!0}))},void 0===l.pixelRatio||"match-device"===l.pixelRatio?(this._pixelRatio="match-device",this.devicePixelRatioQuery=matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")),this.devicePixelRatioQuery.addEventListener("change",this.onDevicePixelRatioChange,{once:!0}),this.renderer.setPixelRatio(window.devicePixelRatio)):(this._pixelRatio=l.pixelRatio,this.devicePixelRatioQuery=null,this.renderer.setPixelRatio(l.pixelRatio)),this.renderer.setClearColor(0,0),this.renderer.capabilities.isWebGL2&&(a=new S(0,0,{depthTexture:new _(0,0,A)})),this.composer=new B(this.renderer,a),this.renderPass=new z(this.scene,this.camera),this.fxaaPass=new D(W),this.composer.addPass(this.renderPass),this.composer.addPass(this.fxaaPass),this.playerObject=new ee,this.playerObject.name="player",this.playerObject.skin.visible=!1,this.playerObject.cape.visible=!1,this.playerWrapper=new v,this.playerWrapper.add(this.playerObject),this.scene.add(this.playerWrapper),this.controls=new I(this.camera,this.canvas),this.controls.enableRotate=!1!==l.enableRotation,this.controls.enableZoom=!1!==l.allowZoom,void 0!==l.skin&&this.loadSkin(l.skin,{model:l.model,ears:"current-skin"===l.ears}),void 0!==l.cape&&this.loadCape(l.cape),void 0!==l.ears&&"current-skin"!==l.ears&&this.loadEars(l.ears.source,{textureType:l.ears.textureType}),void 0!==l.width&&(this.width=l.width),void 0!==l.height&&(this.height=l.height),void 0!==l.background&&(this.background=l.background),void 0!==l.panorama&&this.loadPanorama(l.panorama),void 0!==l.nameTag&&(this.nameTag=l.nameTag),this.camera.position.z=1,this._zoom=null!==(i=l.zoom)&&void 0!==i?i:.9,this.fov=null!==(r=l.fov)&&void 0!==r?r:50,this._animation=null!==(n=l.animation)&&void 0!==n?n:null,this.clock=new F,!0===l.renderPaused?(this._renderPaused=!0,this.animationID=null):this.animationID=window.requestAnimationFrame(function(){return o.draw()}),this.onContextLost=function(e){e.preventDefault(),null!==o.animationID&&(window.cancelAnimationFrame(o.animationID),o.animationID=null)},this.onContextRestored=function(){o.renderer.setClearColor(0,0),o._renderPaused||o._disposed||null!==o.animationID||(o.animationID=window.requestAnimationFrame(function(){return o.draw()}))},this.canvas.addEventListener("webglcontextlost",this.onContextLost,!1),this.canvas.addEventListener("webglcontextrestored",this.onContextRestored,!1),this.canvas.addEventListener("mousedown",function(){o.isUserRotating=!0},!1),this.canvas.addEventListener("mouseup",function(){o.isUserRotating=!1},!1),this.canvas.addEventListener("touchmove",function(e){o.isUserRotating=1===e.touches.length},!1),this.canvas.addEventListener("touchend",function(){o.isUserRotating=!1},!1)},[{key:"updateComposerSize",value:function(){this.composer.setSize(this.width,this.height);var e=this.renderer.getPixelRatio();this.composer.setPixelRatio(e),this.fxaaPass.material.uniforms.resolution.value.x=1/(this.width*e),this.fxaaPass.material.uniforms.resolution.value.y=1/(this.height*e)}},{key:"recreateSkinTexture",value:function(){var e;null===(e=this.skinTexture)||void 0===e||e.dispose(),this.skinTexture=new j(this.skinCanvas),this.skinTexture.magFilter=T,this.skinTexture.minFilter=T,this.playerObject.skin.map=this.skinTexture}},{key:"recreateCapeTexture",value:function(){var e;null===(e=this.capeTexture)||void 0===e||e.dispose(),this.capeTexture=new j(this.capeCanvas),this.capeTexture.magFilter=T,this.capeTexture.minFilter=T,this.playerObject.cape.map=this.capeTexture,this.playerObject.elytra.map=this.capeTexture}},{key:"recreateEarsTexture",value:function(){var e;null===(e=this.earsTexture)||void 0===e||e.dispose(),this.earsTexture=new j(this.earsCanvas),this.earsTexture.magFilter=T,this.earsTexture.minFilter=T,this.playerObject.ears.map=this.earsTexture}},{key:"loadSkin",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e)this.resetSkin();else{if(!n(e))return d(e).then(function(e){return t.loadSkin(e,i)});o(this.skinCanvas,e),this.recreateSkinTexture(),this.playerObject.skin.modelType=void 0===i.model||"auto-detect"===i.model?u(this.skinCanvas):i.model,!1!==i.makeVisible&&(this.playerObject.skin.visible=!0),!0!==i.ears&&"load-only"!==i.ears||(c(this.earsCanvas,e),this.recreateEarsTexture(),!0===i.ears&&(this.playerObject.ears.visible=!0))}}},{key:"resetSkin",value:function(){var e;this.playerObject.skin.visible=!1,this.playerObject.skin.map=null,null===(e=this.skinTexture)||void 0===e||e.dispose(),this.skinTexture=null}},{key:"loadCape",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e)this.resetCape();else{if(!n(e))return d(e).then(function(e){return t.loadCape(e,i)});var r;p(this.capeCanvas,e),this.recreateCapeTexture(),!1!==i.makeVisible&&(this.playerObject.backEquipment=null!==(r=i.backEquipment)&&void 0!==r?r:"cape")}}},{key:"resetCape",value:function(){var e;this.playerObject.backEquipment=null,this.playerObject.cape.map=null,this.playerObject.elytra.map=null,null===(e=this.capeTexture)||void 0===e||e.dispose(),this.capeTexture=null}},{key:"loadEars",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===e)this.resetEars();else{if(!n(e))return d(e).then(function(e){return t.loadEars(e,i)});"skin"===i.textureType?c(this.earsCanvas,e):b(this.earsCanvas,e),this.recreateEarsTexture(),!1!==i.makeVisible&&(this.playerObject.ears.visible=!0)}}},{key:"resetEars",value:function(){var e;this.playerObject.ears.visible=!1,this.playerObject.ears.map=null,null===(e=this.earsTexture)||void 0===e||e.dispose(),this.earsTexture=null}},{key:"loadPanorama",value:function(e){return this.loadBackground(e,U)}},{key:"loadBackground",value:function(e,t){var i,r=this;if(!n(e))return d(e).then(function(e){return r.loadBackground(e,t)});null===(i=this.backgroundTexture)||void 0===i||i.dispose(),this.backgroundTexture=new Q,this.backgroundTexture.image=e,t&&(this.backgroundTexture.mapping=t),this.backgroundTexture.needsUpdate=!0,this.scene.background=this.backgroundTexture}},{key:"draw",value:function(){var e,t=this,i=this.clock.getDelta();null===(e=this._animation)||void 0===e||e.update(this.playerObject,i),!this.autoRotate||this.controls.enableRotate&&this.isUserRotating||(this.playerWrapper.rotation.y+=i*this.autoRotateSpeed),this.controls.update(),this.render(),this.animationID=window.requestAnimationFrame(function(){return t.draw()})}},{key:"render",value:function(){this.composer.render()}},{key:"setSize",value:function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.updateComposerSize()}},{key:"dispose",value:function(){var e;this._disposed=!0,this.canvas.removeEventListener("webglcontextlost",this.onContextLost,!1),this.canvas.removeEventListener("webglcontextrestored",this.onContextRestored,!1),null===(e=this.devicePixelRatioQuery)||void 0===e||e.removeEventListener("change",this.onDevicePixelRatioChange),this.devicePixelRatioQuery=null,null!==this.animationID&&(window.cancelAnimationFrame(this.animationID),this.animationID=null),this.controls.dispose(),this.renderer.dispose(),this.resetSkin(),this.resetCape(),this.resetEars(),this.background=null,this.fxaaPass.fsQuad.dispose()}},{key:"disposed",get:function(){return this._disposed}},{key:"renderPaused",get:function(){return this._renderPaused},set:function(e){var t=this;this._renderPaused=e,e&&null!==this.animationID?(window.cancelAnimationFrame(this.animationID),this.animationID=null,this.clock.stop(),this.clock.autoStart=!0):e||this._disposed||this.renderer.getContext().isContextLost()||null!=this.animationID||(this.animationID=window.requestAnimationFrame(function(){return t.draw()}))}},{key:"width",get:function(){return this.renderer.getSize(new P).width},set:function(e){this.setSize(e,this.height)}},{key:"height",get:function(){return this.renderer.getSize(new P).height},set:function(e){this.setSize(this.width,e)}},{key:"background",get:function(){return this.scene.background},set:function(e){this.scene.background=null===e||e instanceof q||e instanceof Q?e:new q(e),null!==this.backgroundTexture&&e!==this.backgroundTexture&&(this.backgroundTexture.dispose(),this.backgroundTexture=null)}},{key:"adjustCameraDistance",value:function(){var e=4.5+16.5/Math.tan(this.fov/180*Math.PI/2)/this.zoom;e=Math.max(10,Math.min(e,256)),this.camera.position.multiplyScalar(e/this.camera.position.length()),this.camera.updateProjectionMatrix()}},{key:"resetCameraPose",value:function(){this.camera.position.set(0,0,1),this.camera.rotation.set(0,0,0),this.adjustCameraDistance()}},{key:"fov",get:function(){return this.camera.fov},set:function(e){this.camera.fov=e,this.adjustCameraDistance()}},{key:"zoom",get:function(){return this._zoom},set:function(e){this._zoom=e,this.adjustCameraDistance()}},{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(e){"match-device"===e?"match-device"!==this._pixelRatio&&(this._pixelRatio=e,this.onDevicePixelRatioChange()):("match-device"===this._pixelRatio&&null!==this.devicePixelRatioQuery&&(this.devicePixelRatioQuery.removeEventListener("change",this.onDevicePixelRatioChange),this.devicePixelRatioQuery=null),this._pixelRatio=e,this.renderer.setPixelRatio(e),this.updateComposerSize())}},{key:"animation",get:function(){return this._animation},set:function(e){this._animation!==e&&(this.playerObject.resetJoints(),this.playerObject.position.set(0,0,0),this.playerObject.rotation.set(0,0,0),this.clock.stop(),this.clock.autoStart=!0),null!==e&&(e.progress=0),this._animation=e}},{key:"nameTag",get:function(){return this._nameTag},set:function(e){null!==this._nameTag&&this.playerWrapper.remove(this._nameTag),null!==e?(e instanceof G||(e=new ie(e)),this.playerWrapper.add(e),e.position.y=20,this._nameTag=e):this._nameTag=null}},{key:"resetModelRotation",value:function(){this.playerWrapper.rotation.set(0,0,0),this.controls.reset()}}])}();e("V",re)}}})}();
