---
import { Card, CardContent, CardHeader } from "@components/ui/card";
import { Github, Info, MapPin, ThumbsUp } from "@lucide/astro";

import { SkillCloud } from "./SkillCloud";
import { SelfAvatar } from "./SelfAvatar";
import { GitHubInfo } from "./GitHubInfo";
import { School } from "lucide-react";
---

<section id="sh-intro-section" class="relative overflow-hidden w-full">
  <div
    id="sh-intro-description"
    class="flex flex-col gap-4 text-lg text-gray-300 leading-7 mx-auto lg:mx-0 justify-center items-center"
  >
    <h2 class="text-4xl font-bold">關於我</h2>

    <div
      class="grid grid-cols-1 lg:grid-cols-4 lg:grid-rows-4 gap-5 max-w-110 w-full lg:max-w-300"
    >
      <Card
        id="sh-about-description-card"
        className="col-span-2 row-span-2 col-start-1 row-start-1 shadow relative overflow-hidden min-h-100 group hover:bg-stone-800 transition-all duration-300"
      >
        <!-- 背景裝飾 -->
        <div
          class="absolute -top-10 -left-10 w-60 h-60 bg-gradient-to-tr from-purple-500 via-pink-500 to-red-500 rounded-full opacity-20 blur-3xl group-hover:opacity-0 transition-opacity duration-300"
        >
        </div>
        <div class="absolute -bottom-4 left-0 w-full flex">
          <span
            class="w-full text-8xl text-center font-bold sh-background-text-decoration select-none opacity-10 group-hover:opacity-20 transition-opacity duration-300"
            >ABOUT</span
          >
        </div>

        <CardHeader
          id="sh-about-description-card-header"
          className="flex gap-2 items-center font-bold relative z-10"
        >
          <Info size={20} stroke-width={3} />
          自我介紹
        </CardHeader>
        <CardContent
          id="sh-about-description-card-content"
          className="[&>p]:not-last-child:mb-4 relative z-10"
        >
          <p class="lead-8 mb-2">
            嗨！我是 SamHacker，一個熱愛 Coding 的高中生。
          </p>
          <p class="lead-8 mb-2">
            現年（2025 年）
            <span id="sh-intro-age" class="font-bold">:D</span>
            歲，善於運用 TypeScript、Python 等語言。<br />
            最近在學習 Next.js、Vite、React、GSAP 等框架，也計畫要涉獵 Svelte、Vue
            等框架。
          </p>
          <p>前端可能還算可以，但做後端就真的完全不行。</p>
        </CardContent>
      </Card>
      <Card
        className="col-span-1 lg:row-start-3 min-h-50 relative overflow-hidden group hover:bg-stone-800 transition-all duration-300"
      >
        <CardHeader className="flex gap-2 items-center font-bold relative z-10">
          <School size={20} stroke-width={3} />
          學校
        </CardHeader>
        <CardContent className="relative z-10 flex justify-center items-center">
          <SelfAvatar />
        </CardContent>
      </Card>
      <Card className="col-span-2 lg:row-start-4">
        <CardHeader className="flex gap-2 items-center font-bold relative z-10">
          <Github size={20} stroke-width={3} />
          GitHub
        </CardHeader>
        <CardContent className="relative z-10 flex gap-4">
          <GitHubInfo client:load />
        </CardContent>
      </Card>
      <Card
        id="sh-about-location-card"
        className="col-span-2 row-span-2 lg:col-start-3 lg:row-start-3 relative overflow-hidden min-h-50 hover:bg-stone-800 transition-all duration-300"
      >
        <canvas
          id="sh-about-location-cobe-canvas"
          class="absolute -bottom-2/3 left-1/3"
          width="400"
          height="400"></canvas>
        <CardHeader className="flex gap-2 items-center font-bold relative z-10">
          <MapPin size={20} stroke-width={3} />臺中市，臺灣
        </CardHeader>
      </Card>
      <Card
        id="sh-about-skills-card"
        className="col-span-2 row-span-2 lg:col-start-3 lg:row-start-1 shadow min-h-50 pb-0 relative overflow-hidden group hover:bg-neutral-800 transition-all duration-300"
      >
        <div
          class="absolute top-0 -right-25 h-full flex items-center -rotate-90 origin-center"
        >
          <span
            class="text-8xl font-bold sh-background-text-decoration select-none opacity-10 group-hover:opacity-20 transition-opacity duration-300"
          >
            SKILL
          </span>
        </div>

        <CardHeader className="flex gap-2 items-center font-bold relative z-10">
          <ThumbsUp size={20} stroke-width={3} />我的能力
        </CardHeader>
        <CardContent
          id="sh-about-skills-card-content"
          className="relative min-h-40 flex-1 justify-center items-center z-10"
        >
          <!-- <Marquee speed={5} fade pauseOnHover>
            <React class="rounded-lg" size={60} />
            <Figma class="rounded-lg" size={60} />
            <Css class="rounded-lg" size={60} />
            <Html5 class="rounded-lg" size={60} />
            <Javascript class="rounded-lg" size={60} />
            <Typescript class="rounded-lg" size={60} />
            <Nextdotjs class="rounded-lg" size={60} />
            <Nodedotjs class="rounded-lg" size={60} />
            <Python class="rounded-lg" size={60} />
            <Discord class="rounded-lg" size={60} />
            <Discorddotjs class="rounded-lg" size={60} />
            <Tailwindcss class="rounded-lg" size={60} />
            <Astro class="rounded-lg" size={60} />
            <Vite class="rounded-lg" size={60} />
            <Github class="rounded-lg" size={60} />
            <Archlinux class="rounded-lg" size={60} />
            <Linux class="rounded-lg" size={60} />
            <Ubuntu class="rounded-lg" size={60} />
          </Marquee> -->
          <SkillCloud client:only="react" />
        </CardContent>
      </Card>
    </div>
  </div>
</section>

<!-- 地球儀 -->
<script>
  // import createGlobe from "cobe";
  import createGlobe from "cobe";

  let phi = 0;
  let globeRotateSpeed = 1 / 400;
  let canvas = document.getElementById(
    "sh-about-location-cobe-canvas",
  ) as HTMLCanvasElement;

  // hook卡片，確定是否有被hover
  const card = document.getElementById("sh-about-location-card");
  card?.addEventListener("mouseenter", () => {
    globeRotateSpeed = 0;
  });
  card?.addEventListener("mouseleave", () => {
    globeRotateSpeed = 1 / 400;
  });

  const globe = createGlobe(canvas, {
    devicePixelRatio: 2,
    width: 600,
    height: 600,
    phi: 0,
    theta: 0,
    dark: 1,
    diffuse: 2,
    mapSamples: 16_000,
    mapBrightness: 2,
    baseColor: [0.8, 0.8, 0.8],
    markerColor: [1, 1, 1],
    glowColor: [0.5, 0.5, 0.5],
    markers: [
      { location: [24.110780463476758, 120.68685405275627], size: 0.1 },
    ],
    scale: 1.05,
    opacity: 0.9,
    onRender: (state) => {
      state.phi = phi;
      // 沒有被hover時自動旋轉
      phi += globeRotateSpeed;
    },
  });
</script>

<!-- 年齡計算 -->
<script>
  // 計算年齡
  document.addEventListener("DOMContentLoaded", () => {
    const birthDate = new Date("2008-05-15");
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    if (
      monthDiff < 0 ||
      (monthDiff === 0 && today.getDate() < birthDate.getDate())
    ) {
      age--;
    }
    // 更新年齡元素
    const ageElement = document.getElementById("sh-intro-age");
    if (ageElement) {
      ageElement.textContent = age.toString();
    }
  });
</script>
