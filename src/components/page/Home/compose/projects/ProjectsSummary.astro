---
import Projects from "@components/page/Home/sections/Projects.astro";
import { ProjectsList } from "@components/page/Home/compose/projects/ProjectsList";
---

<head>
  <link
    rel="stylesheet"
    type="text/css"
    href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css"
  />
</head>
<div>
  <ProjectsList showFilter={false} maxCards={3} client:load />
</div>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    // 等待 React 組件渲染完成
    setTimeout(() => {
      const projectCards = document.querySelectorAll(".sh-project-card");

      if (projectCards.length > 0) {
        // 設定初始狀態
        gsap.set(projectCards, {
          opacity: 0,
          y: 30,
          scale: 0.98,
          transformOrigin: "center",
        });

        // 創建動畫時間線
        const tl = gsap.timeline({
          scrollTrigger: {
            trigger: ".sh-project-card",
            start: "top 80%",
            toggleActions: "play none none reverse",
          },
        });

        // 逐張卡片動畫
        projectCards.forEach((card, index) => {
          tl.to(
            card,
            {
              duration: 0.6,
              opacity: 1,
              y: 0,
              scale: 1,
              ease: "power2.out",
            },
            index === 0 ? 0 : "-=0.2",
          );
        });

        // 動畫完成後清理 will-change
        tl.call(() => {
          projectCards.forEach((card) => {
            const element = card as HTMLElement;
            if (element) {
              element.style.willChange = "auto";
            }
          });
        });
      }
    }, 1000);
  });
</script>
