---
import { Card, CardContent, CardHeader } from "@components/ui/card";
import { Info, MapPin, ThumbsUp, Phone, School, Share2 } from "@lucide/astro";
import { Github } from "simple-icons-astro";

import { Image } from "astro:assets";
import tcfshImage from "@/assets/pages/home/tcfsh-stroke.svg";

import { SkillCloud } from "@/components/page/Home/compose/self-intro/SkillCloud";
import { GitHubInfo } from "@/components/page/Home/compose/self-intro/GitHubInfo";
import SelfIntroLinkGridIcon from "@/components/page/Home/compose/self-intro/SelfIntroLinkGridIcon.astro";

import config from "@shConfig";
---

<div
  class="grid grid-cols-1 lg:grid-cols-4 lg:grid-rows-4 gap-5 max-w-110 w-full lg:max-w-300"
>
  <!-- 自我介紹 -->
  <Card
    id="sh-about-description-card"
    className="lg:col-span-2 lg:row-span-2 col-start-1 row-start-1 shadow relative overflow-hidden min-h-100 group hover:bg-stone-800 will-change-transform"
  >
    <!-- 背景裝飾 -->
    <div
      class="absolute -top-10 -left-10 w-60 h-60 bg-gradient-to-tr from-purple-500 via-pink-500 to-red-500 rounded-full opacity-20 blur-3xl group-hover:opacity-0 transition-opacity duration-300"
    >
    </div>
    <div class="absolute -bottom-4 left-0 w-full flex">
      <span
        class="w-full text-8xl text-center font-bold sh-background-text-decoration select-none opacity-10 group-hover:opacity-20 transition-opacity duration-300"
        >ABOUT</span
      >
    </div>

    <CardHeader
      id="sh-about-description-card-header"
      className="flex gap-2 items-center font-bold relative z-10"
    >
      <Info size={20} stroke-width={3} />
      自我介紹
    </CardHeader>
    <CardContent
      id="sh-about-description-card-content"
      className="[&>p]:not-last-child:mb-4 relative z-10"
    >
      <p class="lead-8 mb-2">嗨！我是 SamHacker，一個熱愛 Coding 的高中生。</p>
      <p class="lead-8 mb-2">
        現年（2025 年）
        <span id="sh-intro-age" class="font-bold">:D</span>
        歲，善於運用 TypeScript、Python 等語言。<br />
        最近在學習 Next.js、Vite、React、GSAP 等框架，也計畫要涉獵 Svelte、Vue 等框架。
      </p>
      <p class="lead-8 mb-2">
        前端可能還算可以，但做後端就真的完全不行。
        說是這樣說啦，不過這也不代表我只會做網頁。不過C++看起來真的是天書......
      </p>
      <p class="lead-8">
        除了寫程式之外，我也喜歡玩遊戲、聽音樂和閱讀科技相關的文章。
        另外有些時候會去Penana之類的網站上寫一些文章，如果大家有興趣的話也可以去逛逛看。
      </p>
    </CardContent>
  </Card>
  <!-- 學校資訊 -->
  <Card
    id="sh-about-school-card"
    className="col-span-1 lg:row-start-3 min-h-50 relative overflow-hidden group hover:bg-stone-800 will-change-transform"
  >
    <!-- 背景裝飾 -->
    <div
      class="absolute -top-10 -right-10 w-40 h-40 bg-gradient-to-tr from-green-400 via-blue-500 to-purple-600 rounded-full opacity-20 blur-3xl group-hover:opacity-0 transition-opacity duration-300"
    >
    </div>
    <div class="absolute -bottom-4 left-0 w-full flex justify-center">
      <Image
        src={tcfshImage}
        alt="台中一中大門線條圖"
        id="sh-about-school-bg-decoration"
        class="w-4/5 mx-auto select-none pointer-events-none opacity-10 group-hover:opacity-20 transition-opacity duration-300"
      />
    </div>

    <CardHeader className="flex gap-2 items-center font-bold relative z-10">
      <School size={20} stroke-width={3} />
      學校
    </CardHeader>
    <CardContent className="relative z-10 flex justify-center items-center">
      <p>臺中市立臺中第一高級中學</p>
    </CardContent>
  </Card>
  <!-- GitHub資訊 -->
  <Card
    id="sh-about-github-card"
    className="col-span-1 lg:col-span-2 lg:row-start-4 will-change-transform relative overflow-hidden min-h-50 hover:bg-stone-800 "
  >
    <CardHeader className="flex gap-2 items-center font-bold relative z-10">
      <Github size={20} stroke-width={3} />
      GitHub
    </CardHeader>
    <CardContent className="relative z-10 flex gap-4">
      <GitHubInfo client:load />
    </CardContent>
  </Card>
  <!-- 聯絡資訊 -->
  <Card
    id="sh-about-contact-card"
    className="col-span-1 row-span-1 lg:col-start-2 lg:row-start-3 relative overflow-hidden min-h-50 hover:bg-stone-800 will-change-transform"
  >
    <CardHeader className="flex gap-2 items-center font-bold relative z-10">
      <Phone size={20} stroke-width={3} />聯絡我
    </CardHeader>
    <CardContent className="relative z-10">
      <p>
        電子郵件：<a
          href="mailto:xux510208@gmail.com"
          class="text-stone-400 hover:underline"
        >
          <br />
          xux510208@gmail.com
        </a>
      </p>
      <p>
        Discord：<br />
        <span class="text-stone-600 mr-0">
          @
          <a
            href="https://discordapp.com/users/959977374471028779"
            class="text-stone-400 hover:underline"
            >samhacker
          </a>
        </span>
      </p>
    </CardContent>
  </Card>
  <!-- 位置資訊 -->
  <Card
    id="sh-about-location-card"
    className="col-span-1 row-span-1 lg:row-span-2 lg:col-start-3 lg:row-start-3 relative overflow-hidden min-h-50 hover:bg-stone-800 will-change-transform"
  >
    <canvas
      id="sh-about-location-cobe-canvas"
      class="absolute -top-75 lg:top-auto lg:-bottom-1/3 lg:left-10"
      width="400"
      height="400"></canvas>
    <CardHeader className="flex gap-2 items-center font-bold relative z-10">
      <MapPin size={20} stroke-width={3} />臺中市，臺灣
    </CardHeader>
  </Card>
  <!-- 技能雲 -->
  <Card
    id="sh-about-skills-card"
    className="col-span-1 row-span-1 lg:col-span-2 lg:row-span-2 lg:col-start-3 lg:row-start-1 shadow min-h-50 pb-0 relative overflow-hidden group hover:bg-neutral-800 will-change-transform"
  >
    <div
      class="absolute top-0 -right-25 h-full flex items-center -rotate-90 origin-center"
    >
      <span
        class="text-8xl font-bold sh-background-text-decoration select-none opacity-10 group-hover:opacity-20 transition-opacity duration-300"
      >
        SKILL
      </span>
    </div>

    <CardHeader className="flex gap-2 items-center font-bold relative z-10">
      <ThumbsUp size={20} stroke-width={3} />我的能力
    </CardHeader>
    <CardContent
      id="sh-about-skills-card-content"
      className="relative min-h-40 flex-1 justify-center items-center z-10"
    >
      <SkillCloud client:only="react" />
    </CardContent>
  </Card>
  <!-- 社群媒體 -->
  <Card
    id="sh-about-socials-card"
    className="col-span-1 lg:col-start-4 lg:row-start-3 lg:row-span-2 relative overflow-hidden min-h-50 hover:bg-stone-800 will-change-transform"
  >
    <CardHeader className="flex gap-2 items-center font-bold relative z-10">
      <Share2 size={20} stroke-width={3} />社群媒體
    </CardHeader>
    <CardContent
      className="relative z-10 grid grid-cols-4 lg:grid-cols-3 gap-4 py-2"
    >
      {
        config.socialLinks.map((link, index) => (
          <SelfIntroLinkGridIcon href={link.href} key={index}>
            <link.icon class="w-8 h-8" />
          </SelfIntroLinkGridIcon>
        ))
      }
    </CardContent>
  </Card>
</div>

<!-- 地球儀 -->
<script>
  // import createGlobe from "cobe";
  import createGlobe from "cobe";

  let phi = 0;
  let globeRotateSpeed = 1 / 400;
  let canvas = document.getElementById(
    "sh-about-location-cobe-canvas",
  ) as HTMLCanvasElement;

  // hook卡片，確定是否有被hover
  const card = document.getElementById("sh-about-location-card");
  card?.addEventListener("mouseenter", () => {
    globeRotateSpeed = 0;
  });
  card?.addEventListener("mouseleave", () => {
    globeRotateSpeed = 1 / 400;
  });

  const globe = createGlobe(canvas, {
    devicePixelRatio: 2,
    width: 600,
    height: 600,
    phi: 0,
    theta: 0,
    dark: 1,
    diffuse: 2,
    mapSamples: 16_000,
    mapBrightness: 2,
    baseColor: [0.8, 0.8, 0.8],
    markerColor: [1, 1, 1],
    glowColor: [0.5, 0.5, 0.5],
    markers: [
      { location: [24.110780463476758, 120.68685405275627], size: 0.1 },
    ],
    scale: 1.05,
    opacity: 0.9,
    onRender: (state) => {
      state.phi = phi;
      // 沒有被hover時自動旋轉
      phi += globeRotateSpeed;
    },
  });
</script>

<!-- 年齡計算 -->
<script>
  // 計算年齡
  document.addEventListener("DOMContentLoaded", () => {
    const birthDate = new Date("2008-05-15");
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    if (
      monthDiff < 0 ||
      (monthDiff === 0 && today.getDate() < birthDate.getDate())
    ) {
      age--;
    }
    // 更新年齡元素
    const ageElement = document.getElementById("sh-intro-age");
    if (ageElement) {
      ageElement.textContent = age.toString();
    }
  });
</script>

<!-- 動畫 -->
<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import DrawSVG from "gsap/DrawSVGPlugin";

  gsap.registerPlugin(ScrollTrigger);
  gsap.registerPlugin(DrawSVG);

  document.addEventListener("DOMContentLoaded", () => {
    // 設定初始狀態
    const cards = [
      "#sh-about-description-card",
      "#sh-about-location-card",
      "#sh-about-skills-card",
      "#sh-about-github-card",
      "#sh-about-school-card",
      "#sh-about-contact-card",
      "#sh-about-socials-card",
    ];

    cards.forEach((card) => {
      gsap.set(card, {
        opacity: 0,
        y: 30,
        scale: 0.98,
        transformOrigin: "center",
      });
    });

    gsap.set("#sh-about-school-bg-decoration", {
      drawSVG: "0%",
      fillOpacity: 0,
    });

    // 創建動畫時間線
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: "#sh-intro-description",
        start: "top top+=50%",
        end: "bottom 25%",
        toggleActions: "play none none reverse",
      },
    });

    // 優化的動畫序列
    tl.to("#sh-about-description-card", {
      duration: 0.6,
      opacity: 1,
      y: 0,
      scale: 1,
      ease: "power2.out",
    })
      .to(
        "#sh-about-skills-card",
        {
          duration: 0.6,
          opacity: 1,
          y: 0,
          scale: 1,
          ease: "power2.out",
        },
        "-=0.2",
      )
      .to(
        "#sh-about-school-card",
        {
          duration: 0.6,
          opacity: 1,
          y: 0,
          scale: 1,
          ease: "power2.out",
        },
        "-=0.2",
      )
      .to(
        "#sh-about-contact-card",
        {
          duration: 0.6,
          opacity: 1,
          y: 0,
          scale: 1,
          ease: "power2.out",
        },
        "-=0.2",
      )
      .to(
        "#sh-about-github-card",
        {
          duration: 0.6,
          opacity: 1,
          y: 0,
          scale: 1,
          ease: "power2.out",
        },
        "-=0.2",
      )
      .to(
        "#sh-about-location-card",
        {
          duration: 0.6,
          opacity: 1,
          y: 0,
          scale: 1,
          ease: "power2.out",
        },
        "-=0.2",
      )
      .to(
        "#sh-about-socials-card",
        {
          duration: 0.6,
          opacity: 1,
          y: 0,
          scale: 1,
          ease: "power2.out",
        },
        "-=0.2",
      );

    // 動畫完成後清理 will-change
    tl.call(() => {
      cards.forEach((card) => {
        const element = document.querySelector(card) as HTMLElement;
        if (element) {
          element.style.willChange = "auto";
        }
      });
    });
  });
</script>
