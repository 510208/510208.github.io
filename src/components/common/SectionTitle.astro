---
interface Props {
  chinese: string;
  english: string;
  id?: string;
}

const { chinese, english, id } = Astro.props;
---

<div class="flex items-center w-full relative mb-4">
  <h2
    class="sh-title-animation text-3xl font-bold flex items-center gap-4"
    id={id}
  >
    {chinese}
    <span
      class="sh-title-decoration-animation w-[100px] h-[2px] bg-white/30"
      aria-hidden="true"></span>
  </h2>
  <span
    class="sh-title-background-animation absolute left-1/2 -translate-x-1/2 opacity-30 select-none uppercase font-extrabold text-4xl whitespace-nowrap"
    aria-hidden="true"
  >
    {english}
  </span>
</div>

<script>
  import { gsap } from "gsap";
  import { SplitText } from "gsap/SplitText";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(SplitText);
  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const titleContainers = document.querySelectorAll(".sh-title-animation");

    titleContainers.forEach((titleContainer) => {
      const decorationLine = titleContainer.querySelector(
        ".sh-title-decoration-animation",
      );
      const backgroundText = titleContainer.parentElement?.querySelector(
        ".sh-title-background-animation",
      );

      if (!backgroundText) return;

      const split = new SplitText(backgroundText, { type: "chars" });

      // 設置初始狀態
      gsap.set(titleContainer, {
        opacity: 0,
        x: -50,
      });

      gsap.set(decorationLine, {
        width: 0,
      });

      gsap.set(split.chars, {
        x: 0,
        filter: "blur(5px)",
        opacity: 0.3,
      });

      // 建立時間軸動畫
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: titleContainer,
          start: "top 80%",
          toggleActions: "play none none reverse",
        },
      });

      // 1. 標題從左邊淡入
      tl.to(titleContainer, {
        duration: 0.8,
        opacity: 1,
        x: 0,
        ease: "power2.out",
      });

      // 2. 裝飾線條長度漸漸變長
      tl.to(
        decorationLine,
        {
          duration: 0.6,
          width: "100px",
          ease: "power2.out",
        },
        "-=0.2",
      );

      // 3. 背景文字展開動畫
      tl.to(
        split.chars,
        {
          duration: 1.5,
          x: (i, target) => {
            const totalChars = split.chars.length;
            const centerIndex = (totalChars - 1) / 2;
            const charOffset = i - centerIndex;
            const fontSize = parseFloat(getComputedStyle(target).fontSize);
            return charOffset * fontSize;
          },
          filter: "blur(0px)",
          opacity: 0.3,
          ease: "power2.out",
          stagger: 0.08,
        },
        "-=0.3",
      );
    });
  });
</script>
